name: Run JMeter OneWorld Tests

on:
  workflow_dispatch:     # Manual run button in GitHub UI
  push:                  # Auto-run when you push commits

jobs:
  jmeter:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download Apache JMeter
        run: |
          curl -L -o jmeter.zip https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-5.6.3.zip
          tar -xf jmeter.zip

      - name: Prepare results folder
        shell: cmd
        run: |
          if not exist results mkdir results

      - name: Run all OneWorld JMX files
        shell: cmd
        run: |
          for %%f in (jmx\OneWorld\*.jmx) do (
            echo ==========================================
            echo Running %%f
            echo ==========================================
            apache-jmeter-5.6.3\bin\jmeter.bat -n -t "%%f" -l "results\%%~nf.jtl" -e -o "results\%%~nf_report"
          )

      - name: Upload JMeter Results
        uses: actions/upload-artifact@v4
        with:
          name: jmeter-results
          path: results
